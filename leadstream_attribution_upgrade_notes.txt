
LeadStream Upgrade: Multi-Platform Pixel Attribution
----------------------------------------------------

📅 Date: 2025-07-22
🔧 Author: Shaun Palmer / Project Studios
🔁 Feature Set: Attribution Layer + Pixel Injection

Overview:
---------
This upgrade focuses on enhancing LeadStream’s ability to attribute lead sources beyond Google.
Instead of relying solely on last-click or direct session info, this injects tracking logic to capture 
the **first platform attribution** using JavaScript pixel events. This enables more accurate campaign tracking,
especially when dealing with Meta, TikTok, LinkedIn, or other non-Google traffic sources.

Core Idea:
----------
Store the first pixel that fires (Meta, TikTok, LinkedIn, etc.) as the “first attribute” of a visitor session.
Use this to determine the true source of a lead, even if the final conversion occurs via Google or direct visit.

Upgrade Goals:
--------------
✅ Inject all major platform pixels via JavaScript
✅ Watch for the *first* pixel that fires, and save to `window.leadStreamFirstTouch`
✅ Save that event in local/session storage or cookie
✅ Store conversion attribution in LeadStream logs
✅ Provide a passback (optional) to ad platforms (Meta, TikTok, etc.) using JS or server API

Implementation Features:
------------------------
1. **Pixel Watcher Module (JS)**
   - Detect:
     - Facebook Pixel (`fbq`)
     - TikTok Pixel (`ttq`)
     - LinkedIn Insight (`_linkedin_data_partner_id`)
   - Log first pixel type with timestamp.

2. **Attribution Priority Logic**
   - First-touch wins.
   - Custom priority rules (Meta > TikTok > Google).

3. **Session Storage / Cookie Handler**
   - Store attribution data:
     `window.leadStreamFirstTouch = { source: 'facebook', time: 1699488301230 }`
   - Use localStorage or cookies (e.g. `leadstream_first_touch=facebook`)

4. **Conversion Logging Endpoint**
   - Send `POST` to `/leadstream/conversion` with:
     - Attribution source
     - Form data
     - Conversion timestamp

5. **Dashboard Integration**
   - Table: “Top Attribution Sources (First vs Last Touch)”
   - Filters: Time range, device, campaign tag (optional)

6. **Offline Conversion Passback (optional)**
   - Pass conversion back to ad networks via:
     - Meta Conversions API
     - TikTok Events API
     - LinkedIn Insight Tag

Benefits:
---------
- True multi-touch awareness, starting from first unseen platform
- Better ROAS & campaign channel assessment
- Supports high-intent outbound funnels (email/SMS)

Next Steps:
-----------
- Build attribution listener module
- Connect to analytics-injector
- Build pass-through conversion endpoint

Concept: UTM-Aware Pixel Tracker for LeadStream
When a visitor lands with a UTM in the URL, we:

Capture the UTM (?utm_source=pinterest&utm_campaign=weekend_sale)

Identify which platform the click came from

Log it as first-touch

Optionally trigger a specific tracking pixel (e.g., Pinterest tag)

Optionally redirect or adjust layout/offers (smart routing)

🔧 Example Behaviors
UTM Source	Action
pinterest	Fire Pinterest tag, store “pinterest” as origin
instagram	Trigger Meta pixel, tag Instagram origin
gads	Note it as Google Ads, do nothing visually
custom_offer	Redirect to /thank-you-special page if matched

🧪 Starter Pseudocode (Plain JS Logic)

(function() {
  const params = new URLSearchParams(window.location.search);
  const source = params.get("utm_source");
  const campaign = params.get("utm_campaign");

  if (source) {
    window.leadStreamFirstTouch = {
      source: source,
      campaign: campaign || null,
      timestamp: Date.now()
    };

    // Example: fire Pinterest pixel
    if (source === 'pinterest') {
      if (typeof pintrk === 'function') {
        pintrk('track', 'pagevisit');
      }
    }

    // Optional: Smart redirect or offer
    if (campaign === 'special_offer') {
      window.location.href = '/thank-you-special.html';
    }

    // Save to localStorage
    localStorage.setItem('leadStreamFirstTouch', JSON.stringify(window.leadStreamFirstTouch));
  }
})();
🧠 Smart Routing Idea
You can even say:

If utm_campaign=webinar, show different button CTA

If utm_source=linkedin, load alternate testimonial carousel

This could be a plugin for your plugin—like “LeadStream Smart Source Router.”

📌 Feature 1: UTM Builder (Admin Tab)
Pseudocode:


// Inside settings.js
onGenerateClick() {
  const baseUrl = getInput('base_url');
  const params = {
    utm_source: getInput('utm_source'),
    utm_medium: getInput('utm_medium'),
    utm_campaign: getInput('utm_campaign'),
    utm_term: getInput('utm_term'), // optional
    utm_content: getInput('utm_content') // optional
  };

  const queryString = Object.entries(params)
    .filter(([_, val]) => val)
    .map(([key, val]) => `${key}=${encodeURIComponent(val)}`)
    .join('&');

  const finalUrl = `${baseUrl}?${queryString}`;
  displayOutput(finalUrl);
}
UI Blocks:

Form inputs (Base URL + 5 UTM fields)

Generate button

Output area with “Copy URL” button

Optional: dropdown to save/load “campaign presets”

📌 Feature 2: First Touch Attribution Tracker
Pseudocode:


// JS injected site-wide
const urlParams = new URLSearchParams(location.search);
const firstTouch = {
  source: urlParams.get('utm_source'),
  campaign: urlParams.get('utm_campaign'),
  timestamp: Date.now()
};

// Save only if not already set
if (!localStorage.getItem('leadstream_first_touch')) {
  localStorage.setItem('leadstream_first_touch', JSON.stringify(firstTouch));
}
Optional Add-on:

Use this to trigger pixel fires (e.g., Pinterest, TikTok)

Sync to DB on form submit via /leadstream/track.php

📌 Feature 3: Smart Redirects via UTM Logic
Pseudocode:


if (urlParams.get('utm_campaign') === 'welcome-offer') {
  window.location.href = '/thank-you-special';
}
Could even evolve into:

Swap header

Show unique CTA

Highlight pricing block

📌 Feature 4: Pixel Watcher (Silent Attribution Sniffer)
Pseudocode:


if (typeof fbq !== 'undefined') { logPixel('facebook'); }
if (typeof ttq !== 'undefined') { logPixel('tiktok'); }
if (typeof _linkedin_data_partner_id !== 'undefined') { logPixel('linkedin'); }
🧠 Future Sprint Themes (Idea Seeds)
🎯 Lead Quality Scoring (UTM weight + session duration)

📊 Mini Attribution Dashboard (Last 100 lead sources)

🧵 Session Stitching (1st click vs last click logic)

🔄 Webhook out to CRMs (incl. UTM metadata)

🔧 AI Suggestions Tab: “Your Facebook leads bounce after 3s – slow site?”

If you want I can turn this brainstorm into a leadstream_roadmap.md